<!DOCTYPE HTML>

<html lang="en-us">

<head>
	<meta charset="utf-8">
	<title>One Vagrantfile to rule them all - Notes to self</title>
	<meta name="author" content="map[name:Bert Van Vreckem email:bert.vanvreckem@gmail.com]">

	
	
	<meta name="description" content="">
	

	
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
	<link href='http://localhost:1313/notes-to-self/index.xml' rel="alternate" title="Notes to self" type="application/atom+xml">
	
	<link rel="canonical" href="http://localhost:1313/notes-to-self/2015/10/01/one-vagrantfile-to-rule-them-all">
	<link href="http://localhost:1313/notes-to-self//favicon.png" rel="shortcut icon">
	<link href="http://localhost:1313/notes-to-self//css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="http://localhost:1313/notes-to-self//css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	
	<link href="https://fonts.googleapis.com/css?family=Nunito:400,300,700" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	
	<script src="http://localhost:1313/notes-to-self//js/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='https://www.gravatar.com/avatar/" + MD5('bert.vanvreckem@gmail.com') + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="http://localhost:1313/notes-to-self//">Blog</a></li>
    <li><a href="http://localhost:1313/notes-to-self//about/">About</a></li>
    <li><a href="http://localhost:1313/notes-to-self//post/">Archives</a></li>
</ul>


<section class="aboutme">
  <p>
    Linux system administration, config management, and stuff
  </p>
</section>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href='mailto:bert.vanvreckem@gmail.com' title="Email">Email</a>
		
		
		
		
			<a class="twitter" href='https://twitter.com/bertvanvreckem' title="Twitter">Twitter</a>
		
		
			<a class="github" href='https://github.com/bertvv' title="GitHub">GitHub</a>
		
		
		
		
			<a class="linkedin" href='https://www.linkedin.com/in/bertvanvreckem' title="LinkedIn">LinkedIn</a>
		
		
			<a class="youtube" href='https://youtube.com/bertvvrhogent' title="Youtube">Youtube</a>
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href='http://localhost:1313/notes-to-self/index.xml' title="RSS">RSS</a>
		
	</div>
</nav>
</header>
			</div>
		</div>
		<div class="mid-col">
			
			<div class="mid-col-container">
				<div id="content" class="inner">
					<div itemscope itemtype="https://schema.org/Blog">
					<article class="post" itemscope itemtype="https://schema.org/BlogPosting">
    <h1 class="title" itemprop="name">One Vagrantfile to rule them all</h1>
	<div class="entry-content" itemprop="articleBody">

<p>Writing Vagrantfiles is tedious, especially when you&rsquo;re setting up a multi-VM environment. Typically, people will copy/paste code blocks that define hosts, but that becomes unwieldy. However, a Vagrantfile is &ldquo;just&rdquo; Ruby, so can&rsquo;t we simplify things a bit using the power of the language? Turns out, we can! Read below to find how you can reduce setting up a multi-VM Vagrant environment to writing a simple YAML file.</p>

<h2 id="simplifying-multi-vm-setups:c8f35458a74cb8ca2d70d8b99127632a">Simplifying multi-VM setups</h2>

<p>A typical Vagrantfile has separate blocks of code for each host (see e.g. <a href="https://stackoverflow.com/questions/24072916/multi-vm-in-one-vagrantfile-could-i-set-different-memory-size-for-each-of-them">this StackOverflow discussion</a>). When the complexity of your environment grows, this becomes harder and harder to maintain. The <a href="https://docs.vagrantup.com/v2/vagrantfile/tips.html">Vagrant documentation</a> states that you can simplify by introducing loops in your Vagrantfile, but then you have the problem of how to manage differences in the properties of each VM. A nice solution to this is to define a Hash at the beginning of the Vagrantfile with the properties and apply them for each host (see e.g. <a href="https://gist.github.com/dlutzy/2469037">this example</a>).</p>

<h2 id="a-universal-vagrantfile-sort-of:c8f35458a74cb8ca2d70d8b99127632a">A universal Vagrantfile (sort of)</h2>

<p>I developed a Vagrantfile (for the full source, see the end of this post or my Github project <a href="https://github.com/bertvv/ansible-skeleton">ansible-skeleton</a>) where the parts that have to be changed, i.e. properties of individual machines, are stored in a separate YAML file. The Vagrantfile will parse the YAML file and apply the settings to each specified VM. A simple example to get started:</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span style="color: #0099FF; font-style: italic"># vagrant_hosts.yml</span>
- name: box001
  ip: 192.168.56.10
- name: box002
</pre></div>
</p>

<p>This will create a Vagrant environment with two VMs, <code>box001</code> and <code>box002</code>. Each will get a private network interface. For <code>box001</code> a fixed IP address (192.168.56.10) is assigned, <code>box002</code> will get one via DHCP.</p>

<p>The Vagrantfile will parse the YAML and convert it to a Ruby data structure, specifically a list of Hashes:</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%">hosts <span style="color: #555555">=</span> <span style="color: #336600">YAML</span><span style="color: #555555">.</span>load_file(<span style="color: #CC3300">&#39;vagrant_hosts.yml&#39;</span>)
</pre></div>
</p>

<p>This is the main loop of the script that iterates over the <code>hosts</code>:</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1</span>   hosts<span style="color: #555555">.</span>each <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>host<span style="color: #555555">|</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2</span>     config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>define host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>node<span style="color: #555555">|</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3</span>       node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>box <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;box&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">||=</span> <span style="color: #336600">DEFAULT_BASE_BOX</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4</span>       node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>box_url <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;box_url&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">||=</span> <span style="color: #336600">DEFAULT_BASE_BOX_URL</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6</span>       node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>hostname <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7</span>       node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>network <span style="color: #FFCC33">:private_network</span>, network_options(host)
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8</span>       custom_synced_folders(node<span style="color: #555555">.</span>vm, host)
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10</span>       node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provider <span style="color: #FFCC33">:virtualbox</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>vb<span style="color: #555555">|</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11</span>         vb<span style="color: #555555">.</span>name <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12</span>         vb<span style="color: #555555">.</span>customize <span style="color: #555555">[</span><span style="color: #CC3300">&#39;modifyvm&#39;</span>, <span style="color: #FFCC33">:id</span>, <span style="color: #CC3300">&#39;--groups&#39;</span>, <span style="color: #336600">PROJECT_NAME</span><span style="color: #555555">]</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">13</span>       <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">14</span>     <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">15</span>   <span style="color: #006699; font-weight: bold">end</span>
</pre></div>
</p>

<p>In line 2, a new VM is defined with the name <code>host['name']</code>. In the example above, that is <code>box001</code> in the first iteration and <code>box002</code> in te next one.</p>

<p>Then (line 3-4) the a base box is specified. If you don&rsquo;t explicitly define one in <code>vagrant_hosts.yml</code>, a default one will be assigned (specified at the beginning of the Vagrantfile). The same goes for the URL where to download the base box from if it isn&rsquo;t available yet on your machine.</p>

<p>On line 7, a private network interface is added. The second argument, <code>network_options(host)</code> is a function call that reads out specific options for the network card, e.g. network mask, MAC address, etc. I&rsquo;m not going into this in detail, but the code can be found at the end of this post.</p>

<p>It&rsquo;s possible to specify <a href="https://docs.vagrantup.com/v2/synced-folders/index.html">synced folders</a>. Line 8 calls the method that sets these up. An example of how these can be set up in <code>vagrant_hosts.yml</code>:</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%">- name: box002
  ip: 192.168.56.11
  synced_folders:
    - src: test
      dest: /tmp/test
    - src: www
      dest: /var/www/html
      options:
        :create: true
        :owner: root
        :group: root
        :mount_options: [<span style="color: #CC3300">&#39;dmode=0755&#39;</span>, <span style="color: #CC3300">&#39;fmode=0644&#39;</span>]
</pre></div>
</p>

<p>This gives <code>box002</code> two synced folders. One is mounted under <code>/tmp/test</code>, the other under <code>/var/www/html</code>. The second synced folder has a few options, e.g that the owner and group should be <code>root</code> (instead of <code>vagrant</code>). The colons in front of the option names (<code>:create</code>, <code>:group</code>, etc.) are mandatory here.</p>

<p>Finally, lines 10-13 apply a few VirtualBox-specific settings. The VM name in VirtualBox is set to the host name (<code>box002</code>) instead of the standard name assigned by Vagrant (e.g. <code>projectdir_box002_1443709007553_58669</code>). Also, the VMs will be grouped together in the VirtualBox GUI.</p>

<h2 id="provisioning:c8f35458a74cb8ca2d70d8b99127632a">Provisioning</h2>

<p>Once the VM is configured and booted, Vagrant allows you to run a provisioning script that finalizes the configuration of the VM. I use Ansible for this, and let every host read the same master playbook (see the &ldquo;<a href="https://docs.ansible.com/ansible/playbooks_best_practices.html">Playbooks Best Practices</a>&rdquo; section of the <a href="https://docs.ansible.com/ansible/">Ansible Documentation</a>).</p>

<p>However, most of my students are using Windows which is <a href="https://docs.ansible.com/ansible/intro_installation.html#control-machine-requirements">not supported by Ansible</a>. In this case, I work around this problem by installing Ansible on the VM and invoking it locally instead of from the host system. The Vagrantfile detects the host operating system and invokes the appropriate provisioning code:</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1</span> <span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">is_windows</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2</span>   <span style="color: #FFCC33">RbConfig</span>:<span style="color: #FFCC33">:CONFIG</span><span style="color: #555555">[</span><span style="color: #CC3300">&#39;host_os&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">=~</span> <span style="color: #33AAAA">/mswin|mingw|cygwin/</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3</span> <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5</span> <span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">provision_ansible</span>(config)
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6</span>   <span style="color: #006699; font-weight: bold">if</span> is_windows
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7</span>     <span style="color: #0099FF; font-style: italic"># Run shell script that installs and runs Ansible locallty (on Windows)</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8</span>     config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provision <span style="color: #CC3300">&quot;shell&quot;</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>sh<span style="color: #555555">|</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9</span>       sh<span style="color: #555555">.</span>path <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;scripts/playbook-win.sh&quot;</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10</span>     <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11</span>   <span style="color: #006699; font-weight: bold">else</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12</span>     <span style="color: #0099FF; font-style: italic"># Run Ansible from host machine (on Mac/Linux).</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">13</span>     config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provision <span style="color: #CC3300">&quot;ansible&quot;</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>ansible<span style="color: #555555">|</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">14</span>       ansible<span style="color: #555555">.</span>playbook <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;ansible/site.yml&quot;</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">15</span>       ansible<span style="color: #555555">.</span>sudo <span style="color: #555555">=</span> <span style="color: #006699">true</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">16</span>     <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">17</span>   <span style="color: #006699; font-weight: bold">end</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">18</span> <span style="color: #006699; font-weight: bold">end</span>
</pre></div>
</p>

<p>I&rsquo;m not discussing the provisioning script <code>scripts/playbook-win.sh</code> in this blog post. It&rsquo;s based on the work of <a href="https://github.com/KSid/windows-vagrant-ansible">Kawsar Saiyeed</a> and <a href="https://github.com/geerlingguy/JJG-Ansible-Windows">Jeff Geerling</a> and my version can be found on my Github project <a href="https://github.com/bertvv/ansible-skeleton">ansible-skeleton</a>.</p>

<h2 id="conclusion:c8f35458a74cb8ca2d70d8b99127632a">Conclusion</h2>

<p>And that&rsquo;s about it! After setting the default base box name and download URL in the Vagrantfile, you don&rsquo;t need to touch the Vagrantfile anymore. Adding a VM is just a couple of lines of YAML. See the <a href="https://github.com/bertvv/ansible-skeleton/blob/master/vagrant_hosts.yml">source code for <code>vagrant_hosts.yml</code></a> for an overview of all supported settings.</p>

<p>If you have suggestions for improvements, let me know! Pull requests on the <a href="https://github.com/bertvv/ansible-skeleton">project</a> are also more than welcome.</p>

<h2 id="the-complete-vagrantfile:c8f35458a74cb8ca2d70d8b99127632a">The complete Vagrantfile</h2>

<p>You can find the complete Vagrantfile below. The latest version is available in my <a href="https://github.com/bertvv/ansible-skeleton">Ansible skeleton</a> project on Github.</p>

<p><div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span style="color: #0099FF; font-style: italic"># -*- mode: ruby -*-</span>
<span style="color: #0099FF; font-style: italic"># vi: ft=ruby :</span>

<span style="color: #336666">require</span> <span style="color: #CC3300">&#39;rbconfig&#39;</span>
<span style="color: #336666">require</span> <span style="color: #CC3300">&#39;yaml&#39;</span>

<span style="color: #0099FF; font-style: italic"># Set your default base box here</span>
<span style="color: #336600">DEFAULT_BASE_BOX</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;centos71-nocm&#39;</span>
<span style="color: #336600">DEFAULT_BASE_BOX_URL</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;https://tinfbo2.hogent.be/pub/vm/centos71-nocm-1.0.16.box&#39;</span>

<span style="color: #0099FF; font-style: italic">#</span>
<span style="color: #0099FF; font-style: italic"># No changes needed below this point</span>
<span style="color: #0099FF; font-style: italic">#</span>

<span style="color: #336600">VAGRANTFILE_API_VERSION</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;2&#39;</span>
<span style="color: #336600">PROJECT_NAME</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;/&#39;</span> <span style="color: #555555">+</span> <span style="color: #336600">File</span><span style="color: #555555">.</span>basename(<span style="color: #336600">Dir</span><span style="color: #555555">.</span>getwd)

hosts <span style="color: #555555">=</span> <span style="color: #336600">YAML</span><span style="color: #555555">.</span>load_file(<span style="color: #CC3300">&#39;vagrant_hosts.yml&#39;</span>)

<span style="color: #0099FF; font-style: italic"># {{{ Helper functions</span>

<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">is_windows</span>
  <span style="color: #FFCC33">RbConfig</span>:<span style="color: #FFCC33">:CONFIG</span><span style="color: #555555">[</span><span style="color: #CC3300">&#39;host_os&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">=~</span> <span style="color: #33AAAA">/mswin|mingw|cygwin/</span>
<span style="color: #006699; font-weight: bold">end</span>

<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">provision_ansible</span>(config)
  <span style="color: #006699; font-weight: bold">if</span> is_windows
    <span style="color: #0099FF; font-style: italic"># Provisioning configuration for shell script.</span>
    config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provision <span style="color: #CC3300">&quot;shell&quot;</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>sh<span style="color: #555555">|</span>
      sh<span style="color: #555555">.</span>path <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;scripts/playbook-win.sh&quot;</span>
    <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">else</span>
    <span style="color: #0099FF; font-style: italic"># Provisioning configuration for Ansible (for Mac/Linux hosts).</span>
    config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provision <span style="color: #CC3300">&quot;ansible&quot;</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>ansible<span style="color: #555555">|</span>
      ansible<span style="color: #555555">.</span>playbook <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;ansible/site.yml&quot;</span>
      ansible<span style="color: #555555">.</span>sudo <span style="color: #555555">=</span> <span style="color: #006699">true</span>
    <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">end</span>
<span style="color: #006699; font-weight: bold">end</span>

<span style="color: #0099FF; font-style: italic"># Set options for the network interface configuration. All values are</span>
<span style="color: #0099FF; font-style: italic"># optional, and can include:</span>
<span style="color: #0099FF; font-style: italic"># - ip (default = DHCP)</span>
<span style="color: #0099FF; font-style: italic"># - netmask (default value = 255.255.255.0</span>
<span style="color: #0099FF; font-style: italic"># - mac</span>
<span style="color: #0099FF; font-style: italic"># - auto_config (if false, Vagrant will not configure this network interface</span>
<span style="color: #0099FF; font-style: italic"># - intnet (if true, an internal network adapter will be created instead of a</span>
<span style="color: #0099FF; font-style: italic">#   host-only adapter)</span>
<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">network_options</span>(host)
  options <span style="color: #555555">=</span> {}

  <span style="color: #006699; font-weight: bold">if</span> host<span style="color: #555555">.</span>has_key?(<span style="color: #CC3300">&#39;ip&#39;</span>)
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:ip</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;ip&#39;</span><span style="color: #555555">]</span>
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:netmask</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;netmask&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">||=</span> <span style="color: #CC3300">&#39;255.255.255.0&#39;</span>
  <span style="color: #006699; font-weight: bold">else</span>
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:type</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;dhcp&#39;</span>
  <span style="color: #006699; font-weight: bold">end</span>

  <span style="color: #006699; font-weight: bold">if</span> host<span style="color: #555555">.</span>has_key?(<span style="color: #CC3300">&#39;mac&#39;</span>)
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:mac</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;mac&#39;</span><span style="color: #555555">].</span>gsub(<span style="color: #33AAAA">/[-:]/</span>, <span style="color: #CC3300">&#39;&#39;</span>)
  <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">if</span> host<span style="color: #555555">.</span>has_key?(<span style="color: #CC3300">&#39;auto_config&#39;</span>)
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:auto_config</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;auto_config&#39;</span><span style="color: #555555">]</span>
  <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">if</span> host<span style="color: #555555">.</span>has_key?(<span style="color: #CC3300">&#39;intnet&#39;</span>) <span style="color: #555555">&amp;&amp;</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;intnet&#39;</span><span style="color: #555555">]</span>
    options<span style="color: #555555">[</span><span style="color: #FFCC33">:virtualbox__intnet</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> <span style="color: #006699">true</span>
  <span style="color: #006699; font-weight: bold">end</span>

  options
<span style="color: #006699; font-weight: bold">end</span>

<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">custom_synced_folders</span>(vm, host)
  <span style="color: #006699; font-weight: bold">if</span> host<span style="color: #555555">.</span>has_key?(<span style="color: #CC3300">&#39;synced_folders&#39;</span>)
    folders <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;synced_folders&#39;</span><span style="color: #555555">]</span>

    folders<span style="color: #555555">.</span>each <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>folder<span style="color: #555555">|</span>
      vm<span style="color: #555555">.</span>synced_folder folder<span style="color: #555555">[</span><span style="color: #CC3300">&#39;src&#39;</span><span style="color: #555555">]</span>, folder<span style="color: #555555">[</span><span style="color: #CC3300">&#39;dest&#39;</span><span style="color: #555555">]</span>, folder<span style="color: #555555">[</span><span style="color: #CC3300">&#39;options&#39;</span><span style="color: #555555">]</span>
    <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">end</span>
<span style="color: #006699; font-weight: bold">end</span>

<span style="color: #0099FF; font-style: italic"># }}}</span>

<span style="color: #336600">Vagrant</span><span style="color: #555555">.</span>configure(<span style="color: #336600">VAGRANTFILE_API_VERSION</span>) <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>config<span style="color: #555555">|</span>

  hosts<span style="color: #555555">.</span>each <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>host<span style="color: #555555">|</span>
    config<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>define host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>node<span style="color: #555555">|</span>
      node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>box <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;box&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">||=</span> <span style="color: #336600">DEFAULT_BASE_BOX</span>
      node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>box_url <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;box_url&#39;</span><span style="color: #555555">]</span> <span style="color: #555555">||=</span> <span style="color: #336600">DEFAULT_BASE_BOX_URL</span>

      node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>hostname <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span>
      node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>network <span style="color: #FFCC33">:private_network</span>, network_options(host)
      custom_synced_folders(node<span style="color: #555555">.</span>vm, host)

      node<span style="color: #555555">.</span>vm<span style="color: #555555">.</span>provider <span style="color: #FFCC33">:virtualbox</span> <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>vb<span style="color: #555555">|</span>
        vb<span style="color: #555555">.</span>name <span style="color: #555555">=</span> host<span style="color: #555555">[</span><span style="color: #CC3300">&#39;name&#39;</span><span style="color: #555555">]</span>
        vb<span style="color: #555555">.</span>customize <span style="color: #555555">[</span><span style="color: #CC3300">&#39;modifyvm&#39;</span>, <span style="color: #FFCC33">:id</span>, <span style="color: #CC3300">&#39;--groups&#39;</span>, <span style="color: #336600">PROJECT_NAME</span><span style="color: #555555">]</span>
      <span style="color: #006699; font-weight: bold">end</span>
    <span style="color: #006699; font-weight: bold">end</span>
  <span style="color: #006699; font-weight: bold">end</span>
  provision_ansible(config)
<span style="color: #006699; font-weight: bold">end</span>
</pre></div>
</p>
</div></article>
					
						<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size=''></a>
	
	
	</div>
	
  	<script type="text/javascript" src='https://s7.addthis.com/js/250/addthis_widget.js#pubid='></script>
  	
</div>

					
					
					<section id="comment">
					    <h1 class="title">Comments</h1>
					    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
					</section>
					
					

<script type="text/javascript">
    
    var disqus_shortname = 'notes-to-self-bertvv';

    
    

    
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
    
</script>


				    </div>
				</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Bert Van Vreckem

Design credit: <a href="https://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
<script src="http://localhost:1313/notes-to-self//js/slash.js"></script>
<script src="http://localhost:1313/notes-to-self//js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
</footer>
		</div>
	</div>
	
<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
